Google Sheets Budget Bot 2.0 Roadmap
–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–ª–∞–Ω —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è –±–æ—Ç–∞, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö Code Review.

üìÖ –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Data Integrity & Critical Bugs)
–¶–µ–ª—å: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å –ø–æ—Ç–µ—Ä—é –¥–∞–Ω–Ω—ã—Ö –∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏–∫–∏.

1.1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SQLite)
 –ó–∞–¥–∞—á–∞: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ 
type
 –≤ —Ç–∞–±–ª–∏—Ü—É 
transactions
.
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å TransactionRepository.init_db(): –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞–ª–∏—á–∏—è –∫–æ–ª–æ–Ω–∫–∏ 
type
.
–ï—Å–ª–∏ –∫–æ–ª–æ–Ω–∫–∏ –Ω–µ—Ç -> –≤—ã–ø–æ–ª–Ω–∏—Ç—å ALTER TABLE transactions ADD COLUMN type TEXT DEFAULT '–†–∞—Å—Ö–æ–¥'.
–û–±–Ω–æ–≤–∏—Ç—å SQL –∑–∞–ø—Ä–æ—Å —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã CREATE TABLE –¥–ª—è –Ω–æ–≤—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫.
1.2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
 –ó–∞–¥–∞—á–∞: –û–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–∏–ø–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (–î–æ—Ö–æ–¥/–†–∞—Å—Ö–æ–¥).
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–û–±–Ω–æ–≤–∏—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—É TransactionRepository.add_transaction: –¥–æ–±–∞–≤–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç type: str.
–û–±–Ω–æ–≤–∏—Ç—å SQL INSERT –≤ 
add_transaction
.
–û–±–Ω–æ–≤–∏—Ç—å SQL SELECT –≤ 
get_unsynced
 (–¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ 
type
).
1.3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Worker'–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
 –ó–∞–¥–∞—á–∞: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ Google Sheets.
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–í 
sync_worker.py
: —á–∏—Ç–∞—Ç—å –ø–æ–ª–µ 
type
 –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –ë–î.
–£–±—Ä–∞—Ç—å —Ö–∞—Ä–¥–∫–æ–¥ type="–†–∞—Å—Ö–æ–¥". –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –ë–î.
1.4. –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ö–∞—Ä–¥–∫–æ–¥–∞ User ID
 –ó–∞–¥–∞—á–∞: –ó–∞–ø–∏—Å—ã–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–í 
services/transaction_service.py
 (–º–µ—Ç–æ–¥ 
save_transaction
): —É–¥–∞–ª–∏—Ç—å user_id = 1.
–ü—Ä–∏–Ω–∏–º–∞—Ç—å user_id (–∏–∑ Telegram) –∫–∞–∫ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –∏–ª–∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏–∑ –æ–±—ä–µ–∫—Ç–∞ 
transaction
 (–µ—Å–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ user_id –≤ 
TransactionData
 –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ). –ü—Ä–∏–º: –í 
TransactionData
 —Å–µ–π—á–∞—Å –Ω–µ—Ç user_id (int), —Ç–æ–ª—å–∫–æ username. –ù—É–∂–Ω–æ —Ä–µ—à–∏—Ç—å: –¥–æ–±–∞–≤–∏—Ç—å user_id –≤ –º–æ–¥–µ–ª—å –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤ –º–µ—Ç–æ–¥. –†–µ—à–∏–º –¥–æ–±–∞–≤–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç –≤ 
save_transaction
.
üöÄ –≠—Ç–∞–ø 2: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ Code Quality
–¶–µ–ª—å: –£–ª—É—á—à–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –∏ —á–∏—Å—Ç–æ—Ç—É –∫–æ–¥–∞.

2.1. Refactoring Main
 –ó–∞–¥–∞—á–∞: –û—á–∏—Å—Ç–∏—Ç—å 
main.py
.
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –∏–º–ø–æ—Ä—Ç—ã.
–£–ø–æ—Ä—è–¥–æ—á–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é.
2.2. –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∏–π –∑–∞–ø—É—Å–∫
 –ó–∞–¥–∞—á–∞: –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –¥–∞–∂–µ –ø—Ä–∏ —Å–±–æ–µ Sheets API.
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–û–±–µ—Ä–Ω—É—Ç—å 
load_categories_from_sheet
 –≤ try-except.
–ï—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å -> –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É, –Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –∑–∞–ø—É—Å–∫ (–≤–æ–∑–º–æ–∂–Ω–æ, —Å –ø—É—Å—Ç—ã–º –∫—ç—à–µ–º –∏–ª–∏ retry –≤ —Ñ–æ–Ω–µ).
2.3. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
 –ó–∞–¥–∞—á–∞: –ù–µ —Ç–µ—Ä—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø—Ä–∏ —Å–±–æ—è—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–í 
sync_worker.py
: –µ—Å–ª–∏ Validation Error -> –ø–æ–º–µ—á–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é –≤ –ë–î —Ñ–ª–∞–≥–æ–º sync_error (–Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ –∏–ª–∏ —Å—Ç–∞—Ç—É—Å), –∞ –Ω–µ is_synced=1. (–ü–æ–∫–∞ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å CRITICAL –∏ –Ω–µ —Å—Ç–∞–≤–∏—Ç—å is_synced=1, —á—Ç–æ–±—ã –æ–Ω–∞ –≤–∏—Å–µ–ª–∞ –∏ –∞–¥–º–∏–Ω –º–æ–≥ –ø–æ—á–∏–Ω–∏—Ç—å, –Ω–æ —ç—Ç–æ –º–æ–∂–µ—Ç –∑–∞—Å–ø–∞–º–∏—Ç—å –ª–æ–≥. –õ—É—á—à–µ –¥–æ–±–∞–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫ –ø–æ–ø—ã—Ç–æ–∫).
üß† –≠—Ç–∞–ø 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (Future)
–¶–µ–ª—å: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é.

3.1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ML-–∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞
 –ó–∞–¥–∞—á–∞: –£—Å—Ç—Ä–∞–Ω–∏—Ç—å —É—Ç–µ—á–∫—É –ø–∞–º—è—Ç–∏.
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–ü–µ—Ä–µ—Å—Ç–∞—Ç—å —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –≤ self.category_features (RAM).
–°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –≤ —Ñ–∞–π–ª (pickle/joblib) –∏–ª–∏ –ë–î.
3.2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
 –ó–∞–¥–∞—á–∞: –£–π—Ç–∏ –æ—Ç Service Locator.
 –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
–í–Ω–µ–¥—Ä–∏—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ Middleware Aiogram.