# Budget Bot

Budget Bot - это Telegram-бот для ведения личного бюджета, который позволяет автоматически распознавать чеки и записывать транзакции в Google Таблицы. Бот использует API Proverkacheka.com для анализа чеков и предоставляет удобный интерфейс для управления расходами и доходами.

## Структура проекта

```
budget_bot/
├── .gitignore                 # Файл игнорирования для Git
├── config.py                  # Конфигурация приложения (токены, настройки)
├── FEATURE_EDIT_CATEGORY.md   # Документация по фиче редактирования категории
├── main.py                    # Основной файл запуска бота
├── requirements.txt           # Зависимости проекта
├── run_bot.bat                # Скрипт для запуска бота
├── handlers/                  # Обработчики команд и событий
│   └── transactions.py        # Обработчики транзакций
├── models/                    # Модели данных
│   └── transaction.py         # Модели транзакций
├── sheets/                    # Работа с Google Sheets
│   └── client.py              # Клиент для работы с Google Sheets
├── tests/                     # Тесты
│   └── test_category_classifier.py # Тесты классификатора категорий
└── utils/                     # Вспомогательные утилиты
    ├── category_classifier.py # Классификатор категорий с машинным обучением
    ├── exceptions.py          # Кастомные исключения
    ├── keyboards.py           # Клавиатуры бота
    ├── receipt_logic.py       # Логика обработки чеков
    └── service_wrappers.py    # Обертки для сервисов
```

## Существующие модели данных

### Таблица "RawData" (основная таблица транзакций)

| Поле | Описание |
|------|----------|
| Дата операции | Дата транзакции в формате ДД.ММ.ГГГГ |
| Время операции | Время транзакции в формате ЧЧ:ММ:СС |
| Тип | Тип транзакции (Расход/Доход) |
| Категория | Категория транзакции |
| Сумма | Сумма транзакции |
| Комментарий | Комментарий к транзакции |
| Username | Имя пользователя Telegram |
| Продавец | Название магазина/продавца |
| Позиции | Список позиций из чека |
| Оплата | Способ оплаты (Наличные/Карта/Электронный платеж) |

### Таблица "Categories" (таблица категорий)

| Поле | Описание |
|------|----------|
| Категория расхода | Название категории расходов |
| Ключевые слова | Список ключевых слов, разделенных запятой, для автоматического определения категории |
| Категория дохода | Название категории доходов |

## Реализованные команды

| Команда | Описание |
|---------|----------|
| `/start` | Приветственное сообщение и основное меню |
| `/new_transaction` | Начать добавление новой транзакции вручную |
| `/test_sheets` | Проверка подключения к Google Таблицам |

## Ключевые фичи

1. **Автоматическое распознавание чеков**: Бот может распознавать чеки по фото QR-кода и автоматически извлекать информацию о покупке.

2. **Умная категоризация**: Используется машинное обучение для автоматического определения категории транзакции на основе ключевых слов и истории покупок.

3. **Ручной выбор категории**: При низкой уверенности в автоматическом определении категории, пользователю предлагается выбрать подходящую категорию из списка.

4. **Редактирование категории**: Возможность изменить автоматически определенную категорию перед сохранением транзакции.

5. **Запись в Google Таблицы**: Все транзакции автоматически записываются в Google Таблицу для дальнейшего анализа.

6. **Обучение на основе ключевых слов**: Система запоминает ключевые слова для каждой категории, чтобы улучшить точность будущих распознаваний.

7. **Поддержка доходов и расходов**: Бот различает типы транзакций и позволяет вести учет как расходов, так и доходов.

8. **Валидация данных**: Проверка корректности вводимых данных (сумма, размер изображения и т.д.).

9. **Обработка ошибок**: Надежная обработка различных видов ошибок (сетевые, API, файловые).

10. **Многопользовательская поддержка**: Возможность ограничения доступа к боту определенным пользователям.

## Технологии

- Python 3.9+
- aiogram 3.x (фреймворк для Telegram-ботов)
- Google Sheets API
- Proverkacheka.com API для распознавания чеков
- gspread для работы с Google Sheets
- Pydantic для валидации данных
- aiohttp для HTTP-запросов